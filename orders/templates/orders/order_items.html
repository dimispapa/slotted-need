{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
{% endblock %}

{% block content %}
<div class="container mt-2 mt-md-4">

    <!-- Filtering and DataTable -->
    <table id="orderitem-table" class="display table table-bordered">
        <thead>
            <tr>
                <th>Item ID</th>
                <th>Order ID</th>
                <th>Client Name</th>
                <th>Product</th>
                <th>Value</th>
                <th>Item Status</th>
                <th>Priority Level</th>
                <th>Payment Status</th>
                <th>Actions</th>
            </tr>
            <tr class="filter-row">
                <th><input type="text" id="filter-id" placeholder="Filter ID" /></th>
                <th><input type="number" id="filter-order" placeholder="Filter Order ID" /></th>
                <th><input type="text" id="filter-client" placeholder="Filter Client Name" /></th>
                <th><input type="text" id="filter-product" placeholder="Filter Product" /></th>
                <th>
                    <input type="number" id="filter-price-min" placeholder="Min Price" />
                    <input type="number" id="filter-price-max" placeholder="Max Price" />
                </th>
                <th>
                    {% include 'orders/partials/dropdown.html' with options=item_status_choices selected="" class="filter-item-status" id="filter-item-status" %}
                </th>
                <th>
                    {% include 'orders/partials/dropdown.html' with options=priority_level_choices selected="" class="filter-priority-level" id="filter-priority-level" %}
                </th>
                <th>
                    {% include 'orders/partials/dropdown.html' with options=payment_status_choices selected="" class="filter-payment-status" id="filter-payment-status" %}
                </th>
                <th></th> <!-- No filter for actions -->
            </tr>
        </thead>
        <tbody>
            <!-- Data will be populated by DataTables -->
        </tbody>
    </table>

    <!-- Pagination -->
    {% if order_items.has_other_pages %}
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% if order_items.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ order_items.previous_page_number }}&amp;{% if search_query %}search={{ search_query }}&amp;{% endif %}
                            {% if order_status_filter %}order_status={{ order_status_filter }}&amp;{% endif %}
                            {% if payment_status_filter %}payment_status={{ payment_status_filter }}&amp;{% endif %}
                            sort={{ current_sort }}&amp;order={{ current_order }}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">&laquo;</span>
            </li>
            {% endif %}

            {% for num in order_items.paginator.page_range %}
            {% if order_items.number == num %}
            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% elif num > order_items.number|add:'-3' and num < order_items.number|add:'3' %}
            <li class="page-item"><a class="page-link" href="?page={{ num }}&amp;{% if search_query %}search={{ search_query }}&amp;{% endif %}
                            {% if order_status_filter %}order_status={{ order_status_filter }}&amp;{% endif %}
                            {% if payment_status_filter %}payment_status={{ payment_status_filter }}&amp;{% endif %}
                            sort={{ current_sort }}&amp;order={{ current_order }}">{{ num }}</a></li>
            {% endif %}
            {% endfor %}

            {% if order_items.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ order_items.next_page_number }}&amp;{% if search_query %}search={{ search_query }}&amp;{% endif %}
                            {% if order_status_filter %}order_status={{ order_status_filter }}&amp;{% endif %}
                            {% if payment_status_filter %}payment_status={{ payment_status_filter }}&amp;{% endif %}
                            sort={{ current_sort }}&amp;order={{ current_order }}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">&raquo;</span>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/item_tracker.js' %}"></script>
{% endblock %}