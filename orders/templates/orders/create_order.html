{% extends 'base.html' %}
{% load static %}
{% block content %}
  <div class="container mt-5">
    <h1>Create an Order</h1>
    <br />

    <!-- Display messages (success, error, etc.) -->
    {% if messages %}
      <div class="alert-messages">
        {% for message in messages %}
          <div class="alert {{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Form start -->
    <form method="post" id="orderForm">
      {% csrf_token %}

      <!-- Client Information -->
      <div class="form-group">
        <label for="client">Select Existing Client</label>
        {{ form.client }}
      </div>

      <h3>Or Create a New Client</h3>
      <div class="form-group">
        <label for="new_client_name">Client Name</label>
        {{ form.new_client_name }}
      </div>
      <div class="form-group">
        <label for="new_client_phone">Phone</label>
        {{ form.new_client_phone }}
      </div>
      <div class="form-group">
        <label for="new_client_email">Email</label>
        {{ form.new_client_email }}
      </div>

      <!-- Display any formset errors -->
      {% if formset.non_form_errors %}
        <div class="alert alert-danger" role="alert">{{ formset.non_form_errors }}</div>
      {% endif %}

      <!-- Order Items -->
      <h3>Order Items</h3>
      {{ formset.management_form }}
      <div id="order-items">
        {% for form in formset %}
          <div class="card mb-3 order-item-form">
            <div class="card-body">
              <div class="form-group">
                <label for="product">Product</label>
                {{ form.product }}
              </div>
              <div class="form-group">
                <label for="quantity">Quantity</label>
                {{ form.quantity }}
              </div>
              <div class="form-group">
                <label for="option_values">Options</label>
                {{ form.option_values }}
              </div>
              <div class="form-group">
                <label for="finish_options">Finish Options</label>
                {{ form.finish_options }}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Button to Add New Order Item -->
      <button type="button" id="add-order-item" class="btn btn-secondary mb-3">Add Order Item</button>

      <button type="submit" class="btn btn-primary">Submit Order</button>
    </form>
  </div>
{% endblock %}

{% block extras %}
  <script src="{% static 'js/orders.js' %}"></script>
{% endblock %}
