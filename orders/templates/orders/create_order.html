{% extends 'base.html' %}
{% block content %}
  <div class="container mt-5">
    <h1>Create an Order</h1>
    <br />
    <h2>Customer Details:</h2>
    <form method="post" id="orderForm">
      {% csrf_token %}

      <!-- Customer Information -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="customer_name" class="form-label">Customer Name</label>
          <input type="text" id="customer_name" name="customer_name" class="form-control" placeholder="Enter full name" />
        </div>
        <div class="col-md-4">
          <label for="customer_phone" class="form-label">Customer Phone</label>
          <input type="tel" id="customer_phone" name="customer_phone" class="form-control" placeholder="Enter phone number" />
        </div>
        <div class="col-md-6">
          <label for="customer_email" class="form-label">Customer Email</label>
          <input type="email" id="customer_email" name="customer_email" class="form-control" placeholder="Enter email address" />
        </div>
      </div>

      <!-- Display any formset errors -->
      {% if formset.non_form_errors %}
        <div class="alert alert-danger" role="alert">{{ formset.non_form_errors }}</div>
      {% endif %}

      <!-- Formset for Order Items -->
      <div id="order-items">
        {% for form in formset %}
          <div class="card mb-3 order-item">
            <div class="card-body">
              <h5 class="card-title">Order Item {{ forloop.counter }}</h5>

              <!-- Product Dropdown -->
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="product_{{ forloop.counter }}" class="form-label">Product</label>
                  <select class="form-control product-dropdown" name="product_{{ forloop.counter }}" id="product_{{ forloop.counter }}">
                    <option value="">Select a product</option>
                    {% for product in products %}
                      <option value="{{ product.id }}">{{ product.name }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <!-- Dynamic Option Dropdowns (Will be populated by JS) -->
              <div class="row mb-3" id="option-container-{{ forloop.counter }}">
                <!-- JS will inject the option dropdowns here -->
              </div>

              <!-- Dynamic Finish Dropdowns (Will be populated by JS) -->
              <div class="row mb-3" id="finish-container-{{ forloop.counter }}">
                <!-- JS will inject the finish dropdowns here -->
              </div>

              <!-- Display form errors for this item -->
              {% if form.errors %}
                <div class="alert alert-danger" role="alert">{{ form.errors }}</div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Add more items or submit -->
      <div class="row">
        <div class="col-md-6">
          <button type="submit" class="btn btn-primary">Place Order</button>
        </div>
      </div>
    </form>
  </div>
{% endblock %}
